import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium
from folium import plugins
import branca
import matplotlib.pyplot as plt
import seaborn as sns
import matplotlib.font_manager as fm 
from matplotlib import font_manager, rc
import matplotlib

plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

plt.rc('font', family='Malgun Gothic')
sns.set(font="Malgun Gothic",#"NanumGothicCoding", 
        rc={"axes.unicode_minus":False}, # ë§ˆì´ë„ˆìŠ¤ ë¶€í˜¸ ê¹¨ì§ í˜„ìƒ í•´ê²°
        style='darkgrid')        

try : 
    if platform.system() == 'Windows':
    # ìœˆë„ìš°ì¸ ê²½ìš°
        font_name = font_manager.FontProperties(fname="./fonts/MALGUN.ttf").get_name()
        rc('font', family=font_name)
    else:    
    # Mac ì¸ ê²½ìš°
        rc('font', family='AppleGothic')
except : 
    pass
matplotlib.rcParams['axes.unicode_minus'] = False

st.set_page_config(page_title="íˆíŠ¸ë§µ ì‹œê°í™”",layout="wide", page_icon="ğŸ“Š")

# Define your province and city data
sido_options = ["ì„ íƒ","ì„œìš¸íŠ¹ë³„ì‹œ", "ë¶€ì‚°ê´‘ì—­ì‹œ", "ëŒ€êµ¬ê´‘ì—­ì‹œ", "ì¸ì²œê´‘ì—­ì‹œ", "ê´‘ì£¼ê´‘ì—­ì‹œ", "ëŒ€ì „ê´‘ì—­ì‹œ", "ìš¸ì‚°ê´‘ì—­ì‹œ", "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ",  "ê²½ê¸°ë„", "ê°•ì›ë„",
                "ì¶©ì²­ë¶ë„", "ì¶©ì²­ë‚¨ë„", "ì „ë¼ë¶ë„", "ì „ë¼ë‚¨ë„", "ê²½ìƒë¶ë„",  "ê²½ìƒë‚¨ë„", "ì œì£¼íŠ¹ë³„ìì¹˜ë„"]

sigun_list = {
    "ì„œìš¸íŠ¹ë³„ì‹œ": ["ì„ íƒ", "ê°•ë‚¨êµ¬", "ê°•ë™êµ¬", "ê°•ë¶êµ¬", "ê°•ì„œêµ¬", "ê´€ì•…êµ¬", "ê´‘ì§„êµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ë…¸ì›êµ¬", "ë„ë´‰êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ë™ì‘êµ¬", "ë§ˆí¬êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ì„œì´ˆêµ¬", "ì„±ë™êµ¬", "ì„±ë¶êµ¬", "ì†¡íŒŒêµ¬", "ì–‘ì²œêµ¬", "ì˜ë“±í¬êµ¬", "ìš©ì‚°êµ¬", "ì€í‰êµ¬", "ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ì¤‘ë‘êµ¬"],
    "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ì„ íƒ", "ê°•ì„œêµ¬", "ê¸ˆì •êµ¬", "ê¸°ì¥êµ°", "ë‚¨êµ¬", "ë™êµ¬", "ë™ë˜êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë¶êµ¬", "ì‚¬ìƒêµ¬", "ì‚¬í•˜êµ¬", "ì„œêµ¬", "ìˆ˜ì˜êµ¬", "ì—°ì œêµ¬", "ì˜ë„êµ¬", "ì¤‘êµ¬", "í•´ìš´ëŒ€êµ¬"],
    "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ì„ íƒ", "ë‚¨êµ¬", "ë‹¬ì„œêµ¬", "ë‹¬ì„±êµ°", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬", "ìˆ˜ì„±êµ¬", "ì¤‘êµ¬"],
    "ì¸ì²œê´‘ì—­ì‹œ": ["ì„ íƒ", "ê°•í™”êµ°", "ê³„ì–‘êµ¬", "ë¯¸ì¶”í™€êµ¬", "ë‚¨ë™êµ¬", "ë™êµ¬", "ë¶€í‰êµ¬", "ì„œêµ¬", "ì—°ìˆ˜êµ¬", "ì˜¹ì§„êµ°", "ì¤‘êµ¬"],
    "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ì„ íƒ", "ê´‘ì‚°êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬"],
    "ëŒ€ì „ê´‘ì—­ì‹œ": ["ì„ íƒ", "ëŒ€ë•êµ¬", "ë™êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ì¤‘êµ¬"],
    "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ì„ íƒ", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ìš¸ì£¼êµ°", "ì¤‘êµ¬"],
    "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": ["ì„ íƒ", "ì„¸ì¢…ì‹œ"],
    "ê²½ê¸°ë„": ["ì„ íƒ", "ê°€í‰êµ°", "ê³ ì–‘ì‹œ", "ê³¼ì²œì‹œ", "ê´‘ëª…ì‹œ", "ê´‘ì£¼ì‹œ", "êµ¬ë¦¬ì‹œ", "êµ°í¬ì‹œ", "ê¹€í¬ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "ë™ë‘ì²œì‹œ", "ë¶€ì²œì‹œ", "ì„±ë‚¨ì‹œ", "ìˆ˜ì›ì‹œ", "ì‹œí¥ì‹œ", "ì•ˆì‚°ì‹œ", "ì•ˆì„±ì‹œ", "ì•ˆì–‘ì‹œ", "ì–‘ì£¼ì‹œ", "ì–‘í‰êµ°", "ì—¬ì£¼ì‹œ", "ì—°ì²œêµ°", "ì˜¤ì‚°ì‹œ", "ìš©ì¸ì‹œ", "ì˜ì™•ì‹œ", "ì˜ì •ë¶€ì‹œ", "ì´ì²œì‹œ", "íŒŒì£¼ì‹œ", "í‰íƒì‹œ", "í¬ì²œì‹œ", "í•˜ë‚¨ì‹œ", "í™”ì„±ì‹œ"],
    "ê°•ì›ë„": ["ì„ íƒ", "ê°•ë¦‰ì‹œ", "ê³ ì„±êµ°", "ë™í•´ì‹œ", "ì‚¼ì²™ì‹œ", "ì†ì´ˆì‹œ", "ì–‘êµ¬êµ°", "ì–‘ì–‘êµ°", "ì˜ì›”êµ°", "ì›ì£¼ì‹œ", "ì¸ì œêµ°", "ì •ì„ êµ°", "ì² ì›êµ°", "ì¶˜ì²œì‹œ", "íƒœë°±ì‹œ", "í‰ì°½êµ°", "í™ì²œêµ°", "í™”ì²œêµ°", "íš¡ì„±êµ°"],
    "ì¶©ì²­ë¶ë„": ["ì„ íƒ", "ê´´ì‚°êµ°", "ë‹¨ì–‘êµ°", "ë³´ì€êµ°", "ì˜ë™êµ°", "ì˜¥ì²œêµ°", "ìŒì„±êµ°", "ì œì²œì‹œ", "ì¦í‰êµ°", "ì§„ì²œêµ°", "ì²­ì£¼ì‹œ", "ì¶©ì£¼ì‹œ"],
    "ì¶©ì²­ë‚¨ë„": ["ì„ íƒ", "ê³„ë£¡ì‹œ", "ê³µì£¼ì‹œ", "ê¸ˆì‚°êµ°", "ë…¼ì‚°ì‹œ", "ë‹¹ì§„ì‹œ", "ë³´ë ¹ì‹œ", "ë¶€ì—¬êµ°", "ì„œì‚°ì‹œ", "ì„œì²œêµ°", "ì•„ì‚°ì‹œ", "ì˜ˆì‚°êµ°", "ì²œì•ˆì‹œ", "ì²­ì–‘êµ°", "íƒœì•ˆêµ°", "í™ì„±êµ°"],
    "ì „ë¼ë¶ë„": ["ì„ íƒ", "ê³ ì°½êµ°", "êµ°ì‚°ì‹œ", "ê¹€ì œì‹œ", "ë‚¨ì›ì‹œ", "ë¬´ì£¼êµ°", "ë¶€ì•ˆêµ°", "ìˆœì°½êµ°", "ì™„ì£¼êµ°", "ìµì‚°ì‹œ", "ì„ì‹¤êµ°", "ì¥ìˆ˜êµ°", "ì „ì£¼ì‹œ", "ì •ìì‹œ", "ì§„ì•ˆêµ°"],
    "ì „ë¼ë‚¨ë„": ["ì„ íƒ", "ê°•ì§„êµ°", "ê³ í¥êµ°", "ê³¡ì„±êµ°", "ê´‘ì–‘ì‹œ", "êµ¬ë¡€êµ°", "ë‚˜ì£¼ì‹œ", "ë‹´ì–‘êµ°", "ëª©í¬ì‹œ", "ë¬´ì•ˆêµ°", "ë³´ì„±êµ°", "ìˆœì²œì‹œ", "ì‹ ì•ˆêµ°", "ì—¬ìˆ˜ì‹œ", "ì˜ê´‘êµ°", "ì˜ì•”êµ°", "ì™„ë„êµ°", "ì¥ì„±êµ°", "ì¥í¥êµ°", "ì§„ë„êµ°", "í•¨í‰êµ°", "í•´ë‚¨êµ°", "í™”ìˆœêµ°"],
    "ê²½ìƒë¶ë„": ["ì„ íƒ", "ê²½ì‚°ì‹œ", "ê²½ì£¼ì‹œ", "ê³ ë ¹êµ°", "êµ¬ë¯¸ì‹œ", "êµ°ìœ„êµ°", "ê¹€ì²œì‹œ", "ë¬¸ê²½ì‹œ", "ë´‰í™”êµ°", "ìƒì£¼ì‹œ", "ì„±ì£¼êµ°", "ì•ˆë™ì‹œ", "ì˜ë•êµ°", "ì˜ì–‘êµ°", "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "ì˜ˆì²œêµ°", "ìš¸ë¦‰êµ°", "ìš¸ì§„êµ°", "ì˜ì„±êµ°", "ì²­ë„êµ°", "ì²­ì†¡êµ°", "ì¹ ê³¡êµ°"],
    "ê²½ìƒë‚¨ë„": ["ì„ íƒ", "ê±°ì œì‹œ", "ê±°ì°½êµ°", "ê³ ì„±êµ°", "ê¹€í•´ì‹œ", "ë‚¨í•´êµ°", "ë°€ì–‘ì‹œ", "ì‚¬ì²œì‹œ", "ì‚°ì²­êµ°", "ì–‘ì‚°ì‹œ", "ì˜ë ¹êµ°", "ì§„ì£¼ì‹œ", "ì°½ë…•êµ°", "ì°½ì›ì‹œ", "í†µì˜ì‹œ", "í•˜ë™êµ°", "í•¨ì•ˆêµ°", "í•¨ì–‘êµ°", "í•©ì²œêµ°"],
    "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì„ íƒ", "ì„œê·€í¬ì‹œ", "ì œì£¼ì‹œ"]
}

df = pd.read_csv("./ì „êµ­_ì›”ë³„_ìë©´ë™ë³„_ë…ë¦½ë³€ì¸_ë²•ê·œìœ„ë°˜_ë…¸ë©´ìƒíƒœ_ê¸°ìƒìƒíƒœ_ë„ë¡œí˜•íƒœ_ì™„ë£Œ_1006.csv")

col1, col2, col3 = st.columns([1,5,2])
with col2:

    st.markdown("""
    <style>
    .big-font {
        font-size:30px !important;
    }
    </style>
    """, unsafe_allow_html=True)

    st.markdown('<b><p class="big-font">ì‹œë„-ì‹œêµ°ë³„ êµí†µì‚¬ê³ ìœ„í—˜ì§€ìˆ˜ ë¯¼ì›ê±´ìˆ˜ ìƒê´€ê´€ê³„</p></b>', unsafe_allow_html=True)
    
    col4,col5 = st.columns([1,1])
    with col4:
        selected_sido = st.selectbox("ì‹œë„ëª…ì„ ì„ íƒí•˜ì„¸ìš”", sido_options)
        sigun = sigun_list.get(selected_sido, [])
    with col5:
        selected_sigun = st.selectbox("ì‹œêµ°êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”", sigun)


    # Filter the DataFrame based on the selected "ì‹œë„" and "ì‹œêµ°"
    filtered_df = df[(df['ì‹œêµ°êµ¬_ì‹œë„ëª…'] == selected_sido) & (df['ì‹œêµ°êµ¬_ì‹œêµ°ëª…'] == selected_sigun)]

    selected_columns = ['êµí†µì‚¬ê³ ìœ„í—˜ì§€ìˆ˜', 'ê¼¬ë¦¬ë¬¼ê¸°_ê±´ìˆ˜', 'ë¶ˆë²•ìœ í„´_ê±´ìˆ˜', 'ë¶ˆë²•ì¢ŒíšŒì „_ê±´ìˆ˜', 'ì‹ í˜¸ìœ„ë°˜_ê±´ìˆ˜', 'ì—­ì£¼í–‰_ê±´ìˆ˜', 'ì •ì§€ì„ ì¹¨ë²”_ê±´ìˆ˜', 'ì¤‘ì•™ì„ ì¹¨ë²”_ê±´ìˆ˜',
                        'ì§€ì •ì°¨ë¡œìœ„ë°˜_ê±´ìˆ˜', 'ì§„ë¡œë³€ê²½ë°©ë²•ìœ„ë°˜_ê±´ìˆ˜', 'ë¯¼ì›_ì „ì²´ê±´ìˆ˜']


    # Create a subset of the DataFrame with only the selected columns
    filtered_df_subset = filtered_df[selected_columns]

    # Calculate the correlation matrix for the selected columns
    correlation_matrix = filtered_df_subset.corr()

    # Create a heatmap for the selected "ì‹œë„" and "ì‹œêµ°"
    st.write(f"## Heatmap for {selected_sido} {selected_sigun}")
    plt.figure(figsize=(10, 8))
    # sns.heatmap(correlation_matrix, annot=True, cmap="coolwarm", linewidths=.5, fmt=".2f")
    # heatmap_figure = plt.gcf()  # Get the current figure

    # Display the figure using st.pyplot()
    # st.pyplot(heatmap_figure)
    plot = sns.heatmap(correlation_matrix, annot=True, cmap="coolwarm", linewidths=.5, fmt=".2f")
 
    # í”Œë¡¯ì„ Streamlitì— í‘œì‹œ
    st.pyplot(plot.get_figure())

    # Display the filtered DataFrame with the selected columns
    st.write(f"## DataFrame for {selected_sido} {selected_sigun}")
    st.dataframe(filtered_df_subset)
